services:
    elasticsearch:
        container_name: elasticsearch
        environment:
            discovery.type: single-node
        healthcheck:
            interval: 10s
            retries: 3
            test: curl http://localhost:9200/_cat/health
            timeout: 5s
        hostname: elasticsearch
        image: elasticsearch:7.17.9
        ports:
            - 9200:9200
            - 9300:9300
    goc:
        healthcheck:
            interval: 1s
            retries: 10
            test:
                - CMD-SHELL
                - curl -O /dev/null http://localhost:7777 || exit 1
            timeout: 5s
        hostname: goc
        image: goc-server:latest
        ports:
            - 7777:7777
        volumes:
            - /apsarapangu/SSDCache1/ilogtail/behavior-test/report/flusher_elasticsearch_coverage.out:/coverage.log
    ilogtailC:
        depends_on:
            elasticsearch:
                condition: service_healthy
            goc:
                condition: service_healthy
        environment:
            - LOGTAIL_FORCE_COLLECT_SELF_TELEMETRY=true
            - LOGTAIL_DEBUG_FLAG=true
            - LOGTAIL_AUTO_PROF=false
            - LOGTAIL_HTTP_LOAD_CONFIG=true
            - ALICLOUD_LOG_DOCKER_ENV_CONFIG=true
            - ALICLOUD_LOG_PLUGIN_ENV_CONFIG=false
            - ALIYUN_LOGTAIL_USER_DEFINED_ID=1111
        hostname: ilogtail
        image: aliyun/ilogtail:2.0.0
        pid: host
        ports:
            - 18689:18689
        privileged: true
        volumes:
            - /apsarapangu/SSDCache1/ilogtail/behavior-test/report/flusher_elasticsearchdefault_flusher.json:/ilogtail/default_flusher.json
            - /apsarapangu/SSDCache1/ilogtail/behavior-test/report/flusher_elasticsearch_config:/ilogtail/config/local
            - /:/logtail_host
            - /var/run/docker.sock:/var/run/docker.sock
            - /sys/:/sys/
version: "3.8"
